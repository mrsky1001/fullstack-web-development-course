/**
 * ================================================
 * –£–†–û–ö 15: LOCALSTORAGE ‚Äî –•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•
 * ================================================
 * 
 * localStorage ‚Äî —ç—Ç–æ Web Storage API, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π
 * —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π
 * –æ—Å–Ω–æ–≤–µ (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞).
 * 
 * –û–°–ù–û–í–ù–´–ï –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò localStorage:
 * 
 * 1. –û–ë–™–Å–ú: ~5-10 –ú–ë –Ω–∞ –¥–æ–º–µ–Ω (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞)
 * 
 * 2. –¢–ò–ü–´ –î–ê–ù–ù–´–•: —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏!
 *    –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω—É–∂–Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:
 *    - JSON.stringify() ‚Äî –æ–±—ä–µ–∫—Ç ‚Üí —Å—Ç—Ä–æ–∫–∞
 *    - JSON.parse() ‚Äî —Å—Ç—Ä–æ–∫–∞ ‚Üí –æ–±—ä–µ–∫—Ç
 * 
 * 3. –û–ë–õ–ê–°–¢–¨ –î–ï–ô–°–¢–í–ò–Ø:
 *    - –ü—Ä–∏–≤—è–∑–∞–Ω –∫ origin (–ø—Ä–æ—Ç–æ–∫–æ–ª + –¥–æ–º–µ–Ω + –ø–æ—Ä—Ç)
 *    - http://site.com –∏ https://site.com ‚Äî —Ä–∞–∑–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞!
 * 
 * 4. –°–ò–ù–•–†–û–ù–ù–û–°–¢–¨:
 *    - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ)
 *    - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
 * 
 * –ú–ï–¢–û–î–´ localStorage:
 * - setItem(key, value) ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
 * - getItem(key) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
 * - removeItem(key) ‚Äî —É–¥–∞–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
 * - clear() ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
 * - key(index) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –ø–æ –∏–Ω–¥–µ–∫—Å—É
 * - length ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
 * 
 * –°–†–ê–í–ù–ï–ù–ò–ï –° sessionStorage:
 * |                 | localStorage    | sessionStorage   |
 * |-----------------|-----------------|------------------|
 * | –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è   | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ       | –î–æ –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏ |
 * | –î–æ—Å—Ç—É–ø          | –í—Å–µ –≤–∫–ª–∞–¥–∫–∏     | –¢–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∞—è   |
 * | –û–±—ä—ë–º           | 5-10 –ú–ë         | 5-10 –ú–ë          |
 */

// ================================================
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
// ================================================

/**
 * DOMContentLoaded ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
 * –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
 * 
 * –≠—Ç–æ –≤–∞–∂–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è
 * –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞,
 * –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è.
 */
window.addEventListener('DOMContentLoaded', function () {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –∏–º—è
    const savedName = localStorage.getItem('userName');
    if (savedName) {
        document.getElementById('savedName').textContent =
            `–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –∏–º—è: ${savedName}`;
        document.getElementById('nameInput').value = savedName;
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–µ–ª
    loadTodos();

    console.log('üíæ LocalStorage –ø—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω!');
    console.log(`–ó–∞–ø–∏—Å–µ–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: ${localStorage.length}`);
});

// ================================================
// –ü–†–ò–ú–ï–† 1: –°–û–•–†–ê–ù–ï–ù–ò–ï –ü–†–û–°–¢–´–• –î–ê–ù–ù–´–•
// ================================================

/**
 * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ localStorage
 * 
 * setItem(key, value) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
 * - key: —Å—Ç—Ä–æ–∫–∞-–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
 * - value: –∑–Ω–∞—á–µ–Ω–∏–µ (–±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É)
 */
function saveName() {
    const name = document.getElementById('nameInput').value.trim();

    if (name) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        localStorage.setItem('userName', name);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        document.getElementById('savedName').textContent =
            `–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –∏–º—è: ${name}`;

        console.log(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: userName = "${name}"`);
    } else {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!');
    }
}

/**
 * –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
 * 
 * removeItem(key) ‚Äî —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –ø–æ –∫–ª—é—á—É.
 * –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (–±–µ–∑ –æ—à–∏–±–∫–∏).
 */
function clearName() {
    // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
    localStorage.removeItem('userName');

    // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    document.getElementById('savedName').textContent = '';
    document.getElementById('nameInput').value = '';

    console.log('üóëÔ∏è –ò–º—è —É–¥–∞–ª–µ–Ω–æ');
}

// ================================================
// –ü–†–ò–ú–ï–† 2: –•–†–ê–ù–ï–ù–ò–ï –ú–ê–°–°–ò–í–û–í –ò –û–ë–™–ï–ö–¢–û–í
// ================================================

/**
 * localStorage —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏!
 * –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –º–∞—Å—Å–∏–≤–æ–≤ –Ω—É–∂–Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è.
 * 
 * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:   JSON.stringify(object) ‚Üí "string"
 * –ó–∞–≥—Ä—É–∑–∫–∞:     JSON.parse("string") ‚Üí object
 * 
 * –í–ê–ñ–ù–û: –ø—Ä–∏ JSON.parse –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –æ—à–∏–±–∫–∞,
 * –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ try/catch!
 */

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ–ª –∏–∑ localStorage
 */
function getTodos() {
    const todosJSON = localStorage.getItem('todos');

    if (!todosJSON) {
        return []; // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
    }

    try {
        return JSON.parse(todosJSON);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ todos:', error);
        return [];
    }
}

/**
 * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ–ª –≤ localStorage
 */
function saveTodos(todos) {
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ –≤ JSON-—Å—Ç—Ä–æ–∫—É
    const todosJSON = JSON.stringify(todos);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º
    localStorage.setItem('todos', todosJSON);

    console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${todos.length} –∑–∞–¥–∞—á`);
}

/**
 * –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
 */
function addTodo() {
    const input = document.getElementById('todoInput');
    const text = input.value.trim();

    if (text) {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
        const todos = getTodos();

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
        todos.push({
            id: Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏
            text: text,
            completed: false,
            createdAt: new Date().toISOString()
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
        saveTodos(todos);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        loadTodos();

        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        input.value = '';
    }
}

/**
 * –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ ID
 */
function deleteTodo(id) {
    // –§–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Å—Å–∏–≤, –æ—Å—Ç–∞–≤–ª—è—è –≤—Å–µ –∑–∞–¥–∞—á–∏ –∫—Ä–æ–º–µ —É–¥–∞–ª—è–µ–º–æ–π
    const todos = getTodos().filter(todo => todo.id !== id);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
    saveTodos(todos);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    loadTodos();
}

/**
 * –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∑–∞–¥–∞—á–∏
 */
function loadTodos() {
    const todos = getTodos();
    const container = document.getElementById('todoList');

    if (todos.length === 0) {
        container.innerHTML = '<p style="color: #999;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
        return;
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
    container.innerHTML = todos.map(todo => `
        <div class="todo-item">
            <span>${todo.text}</span>
            <button class="btn-danger" onclick="deleteTodo(${todo.id})">√ó</button>
        </div>
    `).join('');
}

// ================================================
// –ü–†–ò–ú–ï–† 3: –ü–†–û–°–ú–û–¢–† –í–°–ï–ì–û –•–†–ê–ù–ò–õ–ò–©–ê
// ================================================

/**
 * –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ localStorage
 * 
 * –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
 */
function showStorage() {
    const data = {};

    // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        let value = localStorage.getItem(key);

        // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
        try {
            value = JSON.parse(value);
        } catch (e) {
            // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ –Ω–µ JSON
        }

        data[key] = value;
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤ –∫—Ä–∞—Å–∏–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    const output = document.getElementById('storageView');
    output.textContent = Object.keys(data).length > 0
        ? JSON.stringify(data, null, 2)
        : '–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—É—Å—Ç–æ';
}

/**
 * –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ localStorage
 * 
 * clear() ‚Äî —É–¥–∞–ª—è–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ origin.
 * –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é!
 */
function clearAll() {
    if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë —Ö—Ä–∞–Ω–∏–ª–∏—â–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        localStorage.clear();

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        showStorage();
        loadTodos();
        document.getElementById('savedName').textContent = '';
        document.getElementById('nameInput').value = '';

        console.log('üóëÔ∏è –•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–µ–Ω–æ');
    }
}

// ================================================
// –û–ë–†–ê–ë–û–¢–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô –í –î–†–£–ì–ò–• –í–ö–õ–ê–î–ö–ê–•
// ================================================

/**
 * –°–æ–±—ã—Ç–∏–µ 'storage' —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ localStorage
 * –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤ –î–†–£–ì–û–ô –≤–∫–ª–∞–¥–∫–µ —Ç–æ–≥–æ –∂–µ —Å–∞–π—Ç–∞.
 * 
 * –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏!
 */
window.addEventListener('storage', function (event) {
    console.log('üì° –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ:');
    console.log(`  –ö–ª—é—á: ${event.key}`);
    console.log(`  –°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${event.oldValue}`);
    console.log(`  –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${event.newValue}`);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    if (event.key === 'todos') {
        loadTodos();
    }
    if (event.key === 'userName') {
        const savedName = document.getElementById('savedName');
        savedName.textContent = event.newValue
            ? `–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ –∏–º—è: ${event.newValue}`
            : '';
    }
});
