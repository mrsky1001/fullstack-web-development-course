/**
 * ================================================
 * –ü–†–û–ï–ö–¢: –ö–†–ï–°–¢–ò–ö–ò-–ù–û–õ–ò–ö–ò
 * ================================================
 * 
 * –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∏–≥—Ä—ã "–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏".
 * 
 * –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
 * - –ò–≥—Ä–∞ –¥–ª—è –¥–≤—É—Ö –∏–≥—Ä–æ–∫–æ–≤ (X –∏ O)
 * - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
 * - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∏—á—å–µ–π
 * - –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–±–µ–¥–Ω–æ–π –ª–∏–Ω–∏–∏
 * - –í–µ–¥–µ–Ω–∏–µ —Å—á—ë—Ç–∞
 * - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
 * - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
 * 
 * @author –ö—É—Ä—Å –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ IEEU
 * @version 1.0.0
 */

// ================================================
// –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´
// ================================================

/**
 * –ú–∞—Å—Å–∏–≤, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ.
 * –ò–Ω–¥–µ–∫—Å—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–ª–µ—Ç–∫–∞–º:
 * [0] [1] [2]
 * [3] [4] [5]
 * [6] [7] [8]
 * 
 * –ó–Ω–∞—á–µ–Ω–∏—è: '' (–ø—É—Å—Ç–æ), 'X', –∏–ª–∏ 'O'
 */
let gameBoard = ['', '', '', '', '', '', '', '', ''];

/**
 * –¢–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫.
 * –ù–∞—á–∏–Ω–∞–µ—Ç –≤—Å–µ–≥–¥–∞ 'X'.
 */
let currentPlayer = 'X';

/**
 * –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã.
 * false, –∫–æ–≥–¥–∞ –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ (–ø–æ–±–µ–¥–∞ –∏–ª–∏ –Ω–∏—á—å—è).
 */
let isGameActive = true;

/**
 * –°—á—ë—Ç –∏–≥—Ä—ã.
 * –•—Ä–∞–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ X, O –∏ –Ω–∏—á—å–∏—Ö.
 */
let scores = {
    X: 0,
    O: 0,
    draw: 0
};

// ================================================
// –ü–û–ë–ï–î–ù–´–ï –ö–û–ú–ë–ò–ù–ê–¶–ò–ò
// ================================================

/**
 * –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–±–µ–¥–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏.
 * –ö–∞–∂–¥—ã–π –º–∞—Å—Å–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω–¥–µ–∫—Å—ã —Ç—Ä—ë—Ö –∫–ª–µ—Ç–æ–∫,
 * –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–∑—É—é—Ç –ø–æ–±–µ–¥–Ω—É—é –ª–∏–Ω–∏—é.
 */
const WINNING_COMBINATIONS = [
    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
    [0, 1, 2], // –í–µ—Ä—Ö–Ω–∏–π —Ä—è–¥
    [3, 4, 5], // –°—Ä–µ–¥–Ω–∏–π —Ä—è–¥
    [6, 7, 8], // –ù–∏–∂–Ω–∏–π —Ä—è–¥

    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
    [0, 3, 6], // –õ–µ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü
    [1, 4, 7], // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü
    [2, 5, 8], // –ü—Ä–∞–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü

    // –î–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
    [0, 4, 8], // –ì–ª–∞–≤–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å (\)
    [2, 4, 6]  // –ü–æ–±–æ—á–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å (/)
];

// ================================================
// DOM –≠–õ–ï–ú–ï–ù–¢–´
// ================================================

/**
 * –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.
 * –≠—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, —á–µ–º –∏—Å–∫–∞—Ç—å –∏—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–Ω–æ–≤–æ.
 */
const elements = {
    // –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –∏ –∫–ª–µ—Ç–∫–∏
    board: document.getElementById('game-board'),
    cells: document.querySelectorAll('.cell'),

    // –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
    gameStatus: document.getElementById('game-status'),
    currentPlayerDisplay: document.getElementById('current-player'),

    // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    restartBtn: document.getElementById('restart-btn'),
    resetScoreBtn: document.getElementById('reset-score-btn'),

    // –¢–∞–±–ª–æ —Å—á—ë—Ç–∞
    scoreX: document.getElementById('score-x'),
    scoreO: document.getElementById('score-o'),
    scoreDraw: document.getElementById('score-draw'),

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    modal: document.getElementById('result-modal'),
    resultTitle: document.getElementById('result-title'),
    resultMessage: document.getElementById('result-message'),
    playAgainBtn: document.getElementById('play-again-btn')
};

// ================================================
// –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´
// ================================================

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ.
 * –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ö–æ–¥–µ.
 * 
 * @param {Event} event - –°–æ–±—ã—Ç–∏–µ –∫–ª–∏–∫–∞
 */
function handleCellClick(event) {
    // –ü–æ–ª—É—á–∞–µ–º –∫–ª–∏–∫–Ω—É—Ç—É—é –∫–ª–µ—Ç–∫—É
    const cell = event.target;

    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–µ–∫—Å –∫–ª–µ—Ç–∫–∏ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
    const index = parseInt(cell.getAttribute('data-index'));

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥:
    // 1. –ö–ª–µ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—É—Å—Ç–æ–π
    // 2. –ò–≥—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–π
    if (gameBoard[index] !== '' || !isGameActive) {
        return; // –í—ã—Ö–æ–¥–∏–º, –µ—Å–ª–∏ —Ö–æ–¥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
    }

    // –î–µ–ª–∞–µ–º —Ö–æ–¥
    makeMove(cell, index);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã
    checkGameResult();
}

/**
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞.
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
 * 
 * @param {HTMLElement} cell - DOM-—ç–ª–µ–º–µ–Ω—Ç –∫–ª–µ—Ç–∫–∏
 * @param {number} index - –ò–Ω–¥–µ–∫—Å –∫–ª–µ—Ç–∫–∏ (0-8)
 */
function makeMove(cell, index) {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
    gameBoard[index] = currentPlayer;

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–∏–º–≤–æ–ª –≤ –∫–ª–µ—Ç–∫–µ
    cell.textContent = currentPlayer;

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
    cell.classList.add(`cell-${currentPlayer.toLowerCase()}`);
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã –ø–æ—Å–ª–µ —Ö–æ–¥–∞.
 * –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: –ø–æ–±–µ–¥–∞, –Ω–∏—á—å—è, –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–≥—Ä—ã.
 */
function checkGameResult() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
    const winResult = checkForWin();

    if (winResult.hasWon) {
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–±–µ–¥—É
        handleWin(winResult.winningCells);
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∏—á—å—é (–≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –Ω–µ—Ç)
    if (checkForDraw()) {
        handleDraw();
        return;
    }

    // –ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è ‚Äî –º–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞
    switchPlayer();
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å.
 * 
 * @returns {Object} –û–±—ä–µ–∫—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º:
 *   - hasWon: boolean ‚Äî –µ—Å—Ç—å –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
 *   - winningCells: number[] ‚Äî –∏–Ω–¥–µ–∫—Å—ã –ø–æ–±–µ–¥–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫
 */
function checkForWin() {
    // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–±–µ–¥–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    for (const combination of WINNING_COMBINATIONS) {
        // –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è: –ø–æ–ª—É—á–∞–µ–º —Ç—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞
        const [a, b, c] = combination;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã:
        // 1. –ü–µ—Ä–≤–∞—è –∫–ª–µ—Ç–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è
        // 2. –í—Å–µ —Ç—Ä–∏ –∫–ª–µ—Ç–∫–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Å–∏–º–≤–æ–ª
        if (
            gameBoard[a] !== '' &&
            gameBoard[a] === gameBoard[b] &&
            gameBoard[b] === gameBoard[c]
        ) {
            // –ü–æ–±–µ–¥–∞ –Ω–∞–π–¥–µ–Ω–∞!
            return {
                hasWon: true,
                winningCells: [a, b, c]
            };
        }
    }

    // –ü–æ–±–µ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
    return {
        hasWon: false,
        winningCells: []
    };
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–∏—á—å–µ–π.
 * –ù–∏—á—å—è ‚Äî –∫–æ–≥–¥–∞ –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –Ω–µ—Ç.
 * 
 * @returns {boolean} true, –µ—Å–ª–∏ –Ω–∏—á—å—è
 */
function checkForDraw() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –∫–ª–µ—Ç–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
    // every() –≤–µ—Ä–Ω—ë—Ç true, –µ—Å–ª–∏ –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –ø—É—Å—Ç—ã–µ
    return gameBoard.every(cell => cell !== '');
}

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–±–µ–¥—É.
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç, –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –∫–ª–µ—Ç–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ.
 * 
 * @param {number[]} winningCells - –ò–Ω–¥–µ–∫—Å—ã –ø–æ–±–µ–¥–Ω—ã—Ö –∫–ª–µ—Ç–æ–∫
 */
function handleWin(winningCells) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
    isGameActive = false;

    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
    scores[currentPlayer]++;
    updateScoreDisplay();

    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø–æ–±–µ–¥–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
    highlightWinningCells(winningCells);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    showResult(`${currentPlayer} –ø–æ–±–µ–¥–∏–ª!`, '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!', currentPlayer.toLowerCase());
}

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∏—á—å—é.
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ.
 */
function handleDraw() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
    isGameActive = false;

    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –Ω–∏—á—å–∏—Ö
    scores.draw++;
    updateScoreDisplay();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    showResult('–ù–∏—á—å—è!', '–ù–∏–∫—Ç–æ –Ω–µ –≤—ã–∏–≥—Ä–∞–ª', 'draw');
}

/**
 * –ú–µ–Ω—è–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞.
 * X ‚Üí O, O ‚Üí X
 */
function switchPlayer() {
    // –¢–µ—Ä–Ω–∞—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    updateCurrentPlayerDisplay();
}

// ================================================
// –§–£–ù–ö–¶–ò–ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø
// ================================================

/**
 * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞.
 */
function updateCurrentPlayerDisplay() {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
    elements.currentPlayerDisplay.textContent = currentPlayer;

    // –û–±–Ω–æ–≤–ª—è–µ–º CSS-–∫–ª–∞—Å—Å –¥–ª—è —Ü–≤–µ—Ç–∞
    elements.currentPlayerDisplay.className = 'current-player';
    elements.currentPlayerDisplay.classList.add(`player-${currentPlayer.toLowerCase()}`);
}

/**
 * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á—ë—Ç–∞.
 */
function updateScoreDisplay() {
    elements.scoreX.textContent = scores.X;
    elements.scoreO.textContent = scores.O;
    elements.scoreDraw.textContent = scores.draw;
}

/**
 * –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –ø–æ–±–µ–¥–Ω—ã–µ –∫–ª–µ—Ç–∫–∏.
 * 
 * @param {number[]} cellIndices - –ò–Ω–¥–µ–∫—Å—ã –∫–ª–µ—Ç–æ–∫ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
 */
function highlightWinningCells(cellIndices) {
    cellIndices.forEach(index => {
        elements.cells[index].classList.add('winner');
    });
}

/**
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
 * 
 * @param {string} title - –ó–∞–≥–æ–ª–æ–≤–æ–∫ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç)
 * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ
 * @param {string} resultType - –¢–∏–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ('x', 'o', 'draw')
 */
function showResult(title, message, resultType) {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç
    elements.resultTitle.textContent = title;
    elements.resultMessage.textContent = message;

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ü–≤–µ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    elements.resultTitle.className = 'modal-title';
    if (resultType === 'x') {
        elements.resultTitle.classList.add('winner-x');
    } else if (resultType === 'o') {
        elements.resultTitle.classList.add('winner-o');
    } else {
        elements.resultTitle.classList.add('draw');
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—É–±–∏—Ä–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç hidden)
    elements.modal.removeAttribute('hidden');
}

/**
 * –°–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ.
 */
function hideModal() {
    elements.modal.setAttribute('hidden', '');
}

// ================================================
// –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ì–†–û–ô
// ================================================

/**
 * –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∏–≥—Ä—É.
 * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ–ª–µ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—á—ë—Ç.
 */
function restartGame() {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    gameBoard = ['', '', '', '', '', '', '', '', ''];
    currentPlayer = 'X';
    isGameActive = true;

    // –û—á–∏—â–∞–µ–º –∫–ª–µ—Ç–∫–∏
    elements.cells.forEach(cell => {
        cell.textContent = '';
        cell.className = 'cell'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    updateCurrentPlayerDisplay();

    // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
    hideModal();
}

/**
 * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á—ë—Ç –∏–≥—Ä—ã.
 */
function resetScore() {
    scores = { X: 0, O: 0, draw: 0 };
    updateScoreDisplay();
}

// ================================================
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
// ================================================

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–≥—Ä—É.
 * –ù–∞–≤–µ—à–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π.
 */
function initGame() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–ª–µ—Ç–∫–∞–º
    elements.cells.forEach(cell => {
        cell.addEventListener('click', handleCellClick);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"
    elements.restartBtn.addEventListener('click', restartGame);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç"
    elements.resetScoreBtn.addEventListener('click', resetScore);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°—ã–≥—Ä–∞—Ç—å –µ—â—ë" –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    elements.playAgainBtn.addEventListener('click', restartGame);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
    elements.modal.addEventListener('click', (event) => {
        // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ —Å–∞–º–æ–º –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ (—Ñ–æ–Ω–µ), –∞ –Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
        if (event.target === elements.modal) {
            restartGame();
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)
    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !elements.modal.hasAttribute('hidden')) {
            restartGame();
        }
    });

    // –ù–∞—á–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    updateCurrentPlayerDisplay();
    updateScoreDisplay();

    console.log('üéÆ –ò–≥—Ä–∞ "–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏" –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!');
}

// ================================================
// –ó–ê–ü–£–°–ö –ò–ì–†–´
// ================================================

/**
 * –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM.
 * 
 * –ò—Å–ø–æ–ª—å–∑—É–µ–º DOMContentLoaded, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è,
 * —á—Ç–æ –≤—Å–µ HTML-—ç–ª–µ–º–µ–Ω—Ç—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã.
 */
if (document.readyState === 'loading') {
    // DOM –µ—â—ë –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
    document.addEventListener('DOMContentLoaded', initGame);
} else {
    // DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω (—Å–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω —Å defer –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ body)
    initGame();
}
