# –£—Ä–æ–∫ 5: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL

## üéØ –¶–µ–ª—å —É—Ä–æ–∫–∞

–ü–æ–¥–∫–ª—é—á–∏—Ç—å MySQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `mysql2` –∏ –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `dotenv`.

## üìö –ò–∑—É—á–∞–µ–º—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

1. **dotenv** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env —Ñ–∞–π–ª–∞
2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. **mysql2** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä MySQL –¥–ª—è Node.js
4. **Connection Pool** ‚Äî –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
5. **Prepared Statements** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç SQL Injection
6. **Service Layer** ‚Äî —Å–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
05-mysql-connection/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.js
‚îÇ   ‚îú‚îÄ‚îÄ server.js
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.service.js          # üÜï –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.service.js     # üÜï –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.controller.js
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.router.js
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/
‚îÇ       ‚îî‚îÄ‚îÄ logger.middleware.js
‚îú‚îÄ‚îÄ .env.example                    # üÜï –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üõ†Ô∏è –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `dotenv` | –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| `mysql2` | –î—Ä–∞–π–≤–µ—Ä MySQL —Å Promise API |
| `services/` | –ü–∞–ø–∫–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ |
| `.env.example` | –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |

## üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd lessons/05-mysql-connection

# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ .env.example)
copy .env.example .env

# 3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env (—É–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç MySQL)

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start
```

## üìä –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE IF NOT EXISTS storedb;
USE storedb;

-- –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Ç–æ–≤–∞—Ä–æ–≤
CREATE TABLE products (
    product_id INT AUTO_INCREMENT PRIMARY KEY,
    product_name VARCHAR(255) NOT NULL,
    product_price DECIMAL(10, 2) NOT NULL,
    product_category VARCHAR(100),
    product_img VARCHAR(500)
);

-- –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
INSERT INTO products (product_name, product_price, product_category) VALUES
    ('Intel Core i9-13900K', 55990, '–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã'),
    ('AMD Ryzen 9 7950X', 62990, '–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã'),
    ('NVIDIA GeForce RTX 4090', 159990, '–í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã');
```

## üîë –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```javascript
// server.js (–ü–ï–†–í–ê–Ø —Å—Ç—Ä–æ–∫–∞!)
require('dotenv').config();

// –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ:
console.log(process.env.DB_HOST); // 'localhost'
console.log(process.env.DB_NAME); // 'storedb'
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```javascript
const mysql = require('mysql2');

const pool = mysql.createPool({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    connectionLimit: 5
});

// –ü—Ä–æ–º–∏—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è async/await
const db = pool.promise();
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

```javascript
// SELECT —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
const [rows] = await db.execute(
    'SELECT * FROM products WHERE product_id = ?',
    [productId]
);

// –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫ (SQL Injection!):
// `SELECT * FROM products WHERE id = ${productId}`
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: .env —Ñ–∞–π–ª

```bash
# .env –ù–ï –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ Git!
# –î–æ–±–∞–≤—å—Ç–µ –≤ .gitignore:
.env
```

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
–ó–∞–ø—Ä–æ—Å ‚Üí Router ‚Üí Controller ‚Üí Service ‚Üí Database
                                    ‚Üì
–û—Ç–≤–µ—Ç  ‚Üê Router ‚Üê Controller ‚Üê Service ‚Üê Database
```

## üìù –ó–∞–¥–∞–Ω–∏—è –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `categories` –∏ —Å–≤—è–∑—å —Å `products`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é

## ‚û°Ô∏è –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ **CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏** (Create, Read, Update, Delete) –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–∫—É–ø–æ–∫.
