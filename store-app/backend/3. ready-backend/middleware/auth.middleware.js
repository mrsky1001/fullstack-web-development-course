/**
 * MIDDLEWARE: Check Auth (Проверка авторизации)
 * 
 * Middleware - это функция, которая выполняется МЕЖДУ получением запроса
 * и запуском основного контроллера.
 * 
 * Эта функция проверяет, вошел ли пользователь в систему.
 * Если да -> пропускает запрос дальше (next()).
 * Если нет -> возвращает ошибку 401 (Unauthorized).
 */

const msgs = require("../lib/messages.lib");

exports.isAuthenticated = (req, res, next) => {
    // req.isAuthenticated() - метод, добавляемый Passport.js
    // Возвращает true, если в сессии есть валидный пользователь.
    if (req.isAuthenticated()) {
        console.log("✅ Доступ разрешен (пользователь авторизован)");
        return next(); // Передаем управление дальше (контроллеру)
    }

    console.log("⛔ Доступ запрещен (пользователь не авторизован)");
    // Если не авторизован - прерываем цепочку и отправляем ответ с ошибкой
    res.status(401).json({
        text: msgs.USER_NOT_AUTH,
        status: 401,
    });
};
