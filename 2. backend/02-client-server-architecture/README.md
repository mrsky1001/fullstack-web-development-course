# Урок 02: Клиент-серверная архитектура

## 🎯 Цели урока

После завершения этого урока вы сможете:

- Объяснить, как работает **клиент-серверная модель**
- Понимать протокол **HTTP** (методы, статус-коды, заголовки)
- Описать принципы **REST API**
- Работать с форматом **JSON**
- Использовать инструменты для тестирования API

---

## 📚 Теоретическая часть

### Клиент-серверная модель

**Клиент** — это программа, которая отправляет запросы (браузер, мобильное приложение).

**Сервер** — это программа, которая принимает запросы и отправляет ответы.

```
┌──────────────┐                          ┌──────────────┐
│              │   1. Запрос (Request)    │              │
│    КЛИЕНТ    │ ─────────────────────────▶   СЕРВЕР     │
│   (Браузер)  │                          │  (Node.js)   │
│              │ ◀───────────────────────  │              │
│              │   2. Ответ (Response)    │              │
└──────────────┘                          └──────────────┘
```

### Пример взаимодействия

```
Пользователь кликает "Показать товары"
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│ КЛИЕНТ (Браузер)                                            │
│                                                             │
│   fetch('http://localhost:3000/api/products')               │
│         │                                                   │
└─────────┼───────────────────────────────────────────────────┘
          │
          │  GET /api/products HTTP/1.1
          ▼
┌─────────────────────────────────────────────────────────────┐
│ СЕРВЕР (Node.js)                                            │
│                                                             │
│   1. Получает запрос                                        │
│   2. Запрашивает данные из БД                               │
│   3. Формирует JSON-ответ                                   │
│   4. Отправляет ответ клиенту                               │
│         │                                                   │
└─────────┼───────────────────────────────────────────────────┘
          │
          │  HTTP/1.1 200 OK
          │  [{"id": 1, "name": "iPhone"}, ...]
          ▼
┌─────────────────────────────────────────────────────────────┐
│ КЛИЕНТ (Браузер)                                            │
│                                                             │
│   Получает данные → Рисует карточки товаров                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🌐 Протокол HTTP

**HTTP** (HyperText Transfer Protocol) — это протокол, по которому браузер общается с сервером. Каждый раз, когда вы открываете сайт, происходит HTTP-запрос.

### Структура HTTP-запроса

```http
GET /api/products HTTP/1.1          ← Стартовая строка
Host: localhost:3000                ← Заголовки
Content-Type: application/json
Authorization: Bearer token123

{"category": "phones"}              ← Тело (опционально)
```

| Часть | Описание |
|-------|----------|
| **Метод** | Тип операции (GET, POST, PUT, DELETE) |
| **URL** | Адрес ресурса (/api/products) |
| **Заголовки** | Метаданные запроса |
| **Тело** | Данные (для POST, PUT) |

### Структура HTTP-ответа

```http
HTTP/1.1 200 OK                     ← Статус
Content-Type: application/json      ← Заголовки
Content-Length: 256

[{"id": 1, "name": "iPhone"}]       ← Тело ответа
```

---

## 📮 HTTP-методы (CRUD)

HTTP-методы определяют, какое действие нужно выполнить. Они соответствуют операциям **CRUD**:

| Метод | CRUD | Описание | Пример |
|-------|------|----------|--------|
| **GET** | Read | Получить данные | Список товаров |
| **POST** | Create | Создать новый ресурс | Добавить товар |
| **PUT** | Update | Полностью обновить | Изменить товар |
| **PATCH** | Update | Частично обновить | Изменить цену |
| **DELETE** | Delete | Удалить | Удалить товар |

### Примеры запросов

```
GET    /api/products        → Получить все товары
GET    /api/products/5      → Получить товар с ID=5
POST   /api/products        → Создать новый товар
PUT    /api/products/5      → Обновить товар с ID=5
DELETE /api/products/5      → Удалить товар с ID=5
```

### Особенности методов

| Метод | Есть тело запроса? | Идемпотентный? | Безопасный? |
|-------|-------------------|----------------|-------------|
| GET | ❌ Нет | ✅ Да | ✅ Да |
| POST | ✅ Да | ❌ Нет | ❌ Нет |
| PUT | ✅ Да | ✅ Да | ❌ Нет |
| DELETE | ❌ Нет | ✅ Да | ❌ Нет |

> **Идемпотентный** = повторный запрос даёт тот же результат.
> **Безопасный** = не изменяет данные на сервере.

---

## 📊 HTTP-статус коды

Сервер всегда возвращает числовой код, показывающий результат операции:

### Группы статус-кодов

| Диапазон | Категория | Описание |
|----------|-----------|----------|
| **1xx** | Информационные | Запрос принят, продолжается обработка |
| **2xx** | Успех | Запрос выполнен успешно |
| **3xx** | Перенаправление | Нужно перейти по другому адресу |
| **4xx** | Ошибка клиента | Проблема в запросе |
| **5xx** | Ошибка сервера | Проблема на сервере |

### Самые важные коды

| Код | Название | Когда используется |
|-----|----------|-------------------|
| **200** | OK | Успешный GET, PUT |
| **201** | Created | Успешный POST (ресурс создан) |
| **204** | No Content | Успешный DELETE (нет тела ответа) |
| **400** | Bad Request | Неверный формат запроса |
| **401** | Unauthorized | Требуется авторизация |
| **403** | Forbidden | Доступ запрещён |
| **404** | Not Found | Ресурс не найден |
| **500** | Internal Server Error | Ошибка на сервере |

### Примеры использования

```javascript
// Успешное получение данных
res.status(200).json({ data: products });

// Успешное создание
res.status(201).json({ message: 'Товар создан', id: 15 });

// Ресурс не найден
res.status(404).json({ error: 'Товар не найден' });

// Ошибка валидации
res.status(400).json({ error: 'Поле "name" обязательно' });

// Нужна авторизация
res.status(401).json({ error: 'Войдите в аккаунт' });
```

---

## 🔗 REST API

**REST** (Representational State Transfer) — это архитектурный стиль для построения API. REST API использует HTTP-методы и URL для работы с ресурсами.

### Принципы REST

| Принцип | Описание |
|---------|----------|
| **Ресурсы** | Всё является ресурсом (пользователь, товар, заказ) |
| **URL** | Каждый ресурс имеет уникальный адрес |
| **HTTP-методы** | Операции определяются методами (GET, POST, ...) |
| **Stateless** | Сервер не хранит состояние между запросами |
| **JSON** | Данные передаются в формате JSON |

### Дизайн REST API

```
/api/products           — Коллекция (много товаров)
/api/products/5         — Один ресурс (товар с ID=5)
/api/users/15/orders    — Вложенный ресурс (заказы пользователя 15)
```

### ❌ Плохой дизайн vs ✅ Хороший дизайн

```
❌ /api/getProducts           →  ✅ GET /api/products
❌ /api/createProduct         →  ✅ POST /api/products
❌ /api/deleteProduct?id=5    →  ✅ DELETE /api/products/5
❌ /api/product_list          →  ✅ GET /api/products
```

### Полный пример REST API

| Операция | Метод | URL | Тело запроса | Ответ |
|----------|-------|-----|--------------|-------|
| Список товаров | GET | /api/products | — | `[{...}, {...}]` |
| Один товар | GET | /api/products/5 | — | `{id: 5, ...}` |
| Создать | POST | /api/products | `{name, price}` | `{id: 6, ...}` |
| Обновить | PUT | /api/products/5 | `{name, price}` | `{id: 5, ...}` |
| Удалить | DELETE | /api/products/5 | — | `204 No Content` |

---

## 📦 Формат JSON

**JSON** (JavaScript Object Notation) — это текстовый формат для обмена данными. Он прост для чтения человеком и программами.

### Синтаксис JSON

```json
{
  "name": "iPhone 15",
  "price": 99990,
  "inStock": true,
  "colors": ["black", "white", "blue"],
  "specs": {
    "memory": 128,
    "camera": "48MP"
  },
  "discount": null
}
```

### Правила JSON

| Правило | Пример |
|---------|--------|
| Строки в двойных кавычках | `"name"`, `"iPhone"` |
| Числа без кавычек | `99990`, `3.14` |
| Булевы значения | `true`, `false` |
| Null | `null` |
| Массивы в квадратных скобках | `["a", "b", "c"]` |
| Объекты в фигурных скобках | `{"key": "value"}` |
| Нет trailing comma | ❌ `{"a": 1,}` |

### JavaScript ↔ JSON

```javascript
// JavaScript объект → JSON строка
const product = { name: 'iPhone', price: 99990 };
const jsonString = JSON.stringify(product);
// '{"name":"iPhone","price":99990}'

// JSON строка → JavaScript объект
const jsonData = '{"name":"iPhone","price":99990}';
const obj = JSON.parse(jsonData);
// { name: 'iPhone', price: 99990 }
```

---

## 🧪 Инструменты для работы с API

### Postman

**Postman** — популярный инструмент для тестирования API.

**Установка:** [postman.com/downloads](https://www.postman.com/downloads/)

**Как использовать:**
1. Выберите метод (GET, POST, ...)
2. Введите URL (http://localhost:3000/api/products)
3. Добавьте Headers и Body (если нужно)
4. Нажмите "Send"
5. Посмотрите ответ

### Thunder Client (VS Code)

Расширение для VS Code, работает как Postman, но прямо в редакторе.

**Установка:** Extensions → Thunder Client

### cURL (Terminal)

Командная строка для HTTP-запросов:

```bash
# GET запрос
curl http://localhost:3000/api/products

# POST запрос с JSON
curl -X POST http://localhost:3000/api/products \
  -H "Content-Type: application/json" \
  -d '{"name": "iPhone", "price": 99990}'

# DELETE запрос
curl -X DELETE http://localhost:3000/api/products/5
```

### JavaScript fetch

```javascript
// GET запрос
const response = await fetch('http://localhost:3000/api/products');
const products = await response.json();

// POST запрос
const response = await fetch('http://localhost:3000/api/products', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        name: 'iPhone',
        price: 99990
    })
});
const newProduct = await response.json();
```

---

## 📋 HTTP-заголовки

Заголовки — это метаданные запроса и ответа.

### Важные заголовки запроса

| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Content-Type` | Формат тела запроса | `application/json` |
| `Accept` | Какой формат ожидает клиент | `application/json` |
| `Authorization` | Токен авторизации | `Bearer token123` |
| `Cookie` | Куки сессии | `session_id=abc123` |

### Важные заголовки ответа

| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Content-Type` | Формат тела ответа | `application/json` |
| `Content-Length` | Размер тела в байтах | `256` |
| `Set-Cookie` | Установить куки | `session_id=abc123` |
| `Access-Control-Allow-Origin` | CORS | `*` или `http://localhost:8000` |

---

## 📁 Структура урока

```
02-client-server-architecture/
│
├── README.md                      # Этот файл (теория)
│
├── examples/
│   ├── 01-http-codes/             # Примеры статус-кодов
│   └── 02-json-examples/          # Примеры JSON
│
├── practice/
│   └── 01-api-testing/            # Практика с Postman
│       └── task.md
│
└── assets/
    └── diagrams/                  # Диаграммы
```

---

## 📖 Глоссарий

| Термин | Определение |
|--------|-------------|
| **HTTP** | Протокол передачи гипертекста |
| **REST** | Архитектурный стиль для API |
| **API** | Интерфейс программирования приложений |
| **JSON** | JavaScript Object Notation — формат данных |
| **Endpoint** | URL-адрес конкретного ресурса API |
| **Request** | Запрос от клиента к серверу |
| **Response** | Ответ от сервера клиенту |
| **Status Code** | Числовой код результата операции |
| **Header** | Заголовок с метаданными |
| **Body** | Тело запроса/ответа с данными |
| **CRUD** | Create, Read, Update, Delete |

---

## ➡️ Что дальше?

В следующем уроке мы перейдём к практике и создадим **первый HTTP-сервер на Node.js**:
- Встроенный модуль `http`
- Установка Express.js
- Обработка GET и POST запросов
- Отправка JSON-ответов

---

**Курс:** Backend | **Урок:** 02-client-server-architecture
