/**
 * ====================================================================
 * –£–†–û–ö 2: –ù–ê–°–¢–†–û–ô–ö–ê EXPRESS.JS - –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (app.js)
 * ====================================================================
 * 
 * –≠—Ç–æ—Ç —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Æ Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
 * –ú—ã –æ—Ç–¥–µ–ª—è–µ–º –µ–≥–æ –æ—Ç server.js –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞.
 * 
 * –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ app.js –∏ server.js ‚Äî —ç—Ç–æ —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:
 * - app.js ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Express (–º–∞—Ä—à—Ä—É—Ç—ã, middleware)
 * - server.js ‚Äî –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (—Ç–æ–ª—å–∫–æ listen)
 * 
 * –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å app.
 * ====================================================================
 */

// –®–ê–ì 1: –ü–æ–¥–∫–ª—é—á–∞–µ–º Express
// --------------------------------------------------------------------
// Express ‚Äî —ç—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Node.js, —É–ø—Ä–æ—â–∞—é—â–∏–π —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤.
// –û–Ω –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è –º–Ω–æ–≥–æ —Ä—É—Ç–∏–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã (–ø–∞—Ä—Å–∏–Ω–≥, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è).

const express = require('express');

// –®–ê–ì 2: –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
// --------------------------------------------------------------------
// –§—É–Ω–∫—Ü–∏—è express() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
// –ü–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é –µ–≥–æ –Ω–∞–∑—ã–≤–∞—é—Ç 'app' –∏–ª–∏ 'server'.

const app = express();

// –®–ê–ì 3: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ middleware
// --------------------------------------------------------------------
// Middleware ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∑–∞–ø—Ä–æ—Å –ü–ï–†–ï–î –º–∞—Ä—à—Ä—É—Ç–∞–º–∏.
// 
// express.json() ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç JSON –≤ req.body
// express.urlencoded() ‚Äî –ø–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ HTML —Ñ–æ—Ä–º

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// –®–ê–ì 4: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç—ã (Routes)
// --------------------------------------------------------------------
// –í Express –º–∞—Ä—à—Ä—É—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–æ—â–µ, —á–µ–º –≤ "—á–∏—Å—Ç–æ–º" Node.js.
// –§–æ—Ä–º–∞—Ç: app.–ú–ï–¢–û–î(–ø—É—Ç—å, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫)
// 
// –ú–µ—Ç–æ–¥—ã: get, post, put, delete, patch, options, all

// 4.1 –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
app.get('/', (req, res) => {
    // res.send() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    // - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç Content-Type –ø–æ —Ç–∏–ø—É –¥–∞–Ω–Ω—ã—Ö
    // - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Content-Length
    // - –ó–∞–≤–µ—Ä—à–∞–µ—Ç –æ—Ç–≤–µ—Ç (–Ω–µ –Ω—É–∂–µ–Ω res.end())

    res.send(`
        <h1>üöÄ Express.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
        <p>–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Express!</p>
        <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã:</h3>
        <ul>
            <li><a href="/about">–û –ø—Ä–æ–µ–∫—Ç–µ</a> (GET)</li>
            <li><a href="/api/status">–°—Ç–∞—Ç—É—Å API</a> (GET)</li>
            <li><a href="/api/products">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</a> (GET)</li>
        </ul>
    `);
});

// 4.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–û –ø—Ä–æ–µ–∫—Ç–µ"
app.get('/about', (req, res) => {
    res.send(`
        <h1>üìö –û –ø—Ä–æ–µ–∫—Ç–µ</h1>
        <p>–≠—Ç–æ —É—Ä–æ–∫ 2 –∫—É—Ä—Å–∞ Full-Stack Web Development.</p>
        <p>–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –∏–∑—É—á–∞–µ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Express.js.</p>
        <p><a href="/">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></p>
    `);
});

// 4.3 API: –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ (JSON)
app.get('/api/status', (req, res) => {
    // res.json() ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ JSON
    // –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Content-Type: application/json

    res.json({
        status: 'success',
        message: '–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Express.js!',
        framework: 'Express 4.x',
        timestamp: new Date().toISOString()
    });
});

// 4.4 API: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–∑–∞–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö —É—Ä–æ–∫–æ–≤)
app.get('/api/products', (req, res) => {
    // –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Å—Å–∏–≤
    // –í –±—É–¥—É—â–∏—Ö —É—Ä–æ–∫–∞—Ö –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

    const products = [
        { id: 1, name: 'Intel Core i9-13900K', price: 55990, category: '–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã' },
        { id: 2, name: 'AMD Ryzen 9 7950X', price: 62990, category: '–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã' },
        { id: 3, name: 'NVIDIA GeForce RTX 4090', price: 159990, category: '–í–∏–¥–µ–æ–∫–∞—Ä—Ç—ã' }
    ];

    res.json({
        status: 'success',
        data: products,
        count: products.length
    });
});

// 4.5 –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ (404)
// --------------------------------------------------------------------
// –í–ê–ñ–ù–û: –≠—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–û–°–õ–ï–î–ù–ò–ú!
// app.use() –±–µ–∑ –ø—É—Ç–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ –í–°–ï –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥–æ—à–ª–∏ –≤—ã—à–µ.

app.use((req, res) => {
    res.status(404).json({
        status: 'error',
        message: `–ú–∞—Ä—à—Ä—É—Ç ${req.method} ${req.url} –Ω–µ –Ω–∞–π–¥–µ–Ω`,
        statusCode: 404
    });
});

// –®–ê–ì 5: –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
// --------------------------------------------------------------------
// module.exports –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å app –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö (server.js)

module.exports = app;
