/**
 * ================================================
 * –£–†–û–ö 14: –†–ê–ë–û–¢–ê –° –§–û–†–ú–ê–ú–ò ‚Äî –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –ü–†–ò–ú–ï–†
 * ================================================
 * 
 * –§–û–†–ú–´ –í JAVASCRIPT ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç
 * –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.
 * 
 * –ö–õ–Æ–ß–ï–í–´–ï –ö–û–ù–¶–ï–ü–¶–ò–ò:
 * 
 * 1. –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–•:
 *    - input.value ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
 *    - checkbox.checked ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞ (true/false)
 *    - select.value ‚Äî –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
 *    - FormData ‚Äî –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
 * 
 * 2. –°–û–ë–´–¢–ò–Ø –§–û–†–ú–´:
 *    - submit ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
 *    - input ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª)
 *    - change ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞
 *    - focus/blur ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ/–ø–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞
 * 
 * 3. –í–ê–õ–ò–î–ê–¶–ò–Ø:
 *    - HTML5 –∞—Ç—Ä–∏–±—É—Ç—ã: required, minlength, pattern, type
 *    - JavaScript: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
 *    - –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
 * 
 * 4. event.preventDefault():
 *    - –û—Ç–º–µ–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
 *    - –î–ª—è —Ñ–æ—Ä–º: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
 */

// ================================================
// –≠–õ–ï–ú–ï–ù–¢–´ DOM
// ================================================

const form = document.getElementById('registrationForm');
const username = document.getElementById('username');
const email = document.getElementById('email');
const password = document.getElementById('password');
const confirmPassword = document.getElementById('confirmPassword');
const result = document.getElementById('result');

// ================================================
// –í–ê–õ–ò–î–ê–¶–ò–Ø –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò
// ================================================

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * 
 * –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
 * - –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞
 * - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
 * 
 * –°–æ–±—ã—Ç–∏–µ 'input' —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏,
 * –ø–æ–∑–≤–æ–ª—è—è –¥–∞–≤–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å.
 */
username.addEventListener('input', function () {
    const isValid = this.value.length >= 3;
    validateField(
        this,
        isValid,
        'usernameError',
        '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤'
    );
});

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è email
 * 
 * –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞:
 * - ^ ‚Äî –Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏
 * - [^\s@]+ ‚Äî –æ–¥–∏–Ω –∏–ª–∏ –±–æ–ª–µ–µ —Å–∏–º–≤–æ–ª–æ–≤, –∫—Ä–æ–º–µ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ @
 * - @ ‚Äî —Å–∏–º–≤–æ–ª @
 * - [^\s@]+ ‚Äî –¥–æ–º–µ–Ω
 * - \. ‚Äî —Ç–æ—á–∫–∞
 * - [^\s@]+ ‚Äî –¥–æ–º–µ–Ω –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
 * - $ ‚Äî –∫–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏
 */
email.addEventListener('input', function () {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const isValid = emailPattern.test(this.value);
    validateField(
        this,
        isValid,
        'emailError',
        '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'
    );
});

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
 * 
 * –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
 * - –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
 * 
 * –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
 * —Å –ø–æ–ª–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –æ–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ).
 */
password.addEventListener('input', function () {
    const isValid = this.value.length >= 6;
    validateField(
        this,
        isValid,
        'passwordError',
        '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤'
    );

    // –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
    if (confirmPassword.value) {
        const confirmValid = confirmPassword.value === this.value;
        validateField(
            confirmPassword,
            confirmValid,
            'confirmError',
            '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'
        );
    }
});

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
 * 
 * –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–∞—Ä–æ–ª–µ–º.
 */
confirmPassword.addEventListener('input', function () {
    const isValid = this.value === password.value;
    validateField(
        this,
        isValid,
        'confirmError',
        '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'
    );
});

// ================================================
// –§–£–ù–ö–¶–ò–Ø –í–ê–õ–ò–î–ê–¶–ò–ò –ü–û–õ–Ø
// ================================================

/**
 * validateField ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 * 
 * @param {HTMLElement} input ‚Äî –ø–æ–ª–µ –≤–≤–æ–¥–∞
 * @param {boolean} isValid ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
 * @param {string} errorId ‚Äî ID —ç–ª–µ–º–µ–Ω—Ç–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
 * @param {string} message ‚Äî —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
 * 
 * –†–∞–±–æ—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏:
 * 1. –ù–∞—Ö–æ–¥–∏—Ç —ç–ª–µ–º–µ–Ω—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ
 * 2. –î–æ–±–∞–≤–ª—è–µ—Ç/—É–¥–∞–ª—è–µ—Ç CSS-–∫–ª–∞—Å—Å—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç/—Å–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
 */
function validateField(input, isValid, errorId, message) {
    const errorEl = document.getElementById(errorId);

    if (isValid) {
        // –ü–æ–ª–µ –≤–∞–ª–∏–¥–Ω–æ
        input.classList.remove('invalid');
        input.classList.add('valid');
        errorEl.textContent = '';
    } else {
        // –ü–æ–ª–µ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ
        input.classList.remove('valid');
        input.classList.add('invalid');
        errorEl.textContent = message;
    }

    return isValid;
}

// ================================================
// –û–¢–ü–†–ê–í–ö–ê –§–û–†–ú–´
// ================================================

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
 * 
 * –í–ê–ñ–ù–û: event.preventDefault() ‚Äî –∫–ª—é—á–µ–≤–æ–π –º–µ—Ç–æ–¥!
 * –ë–µ–∑ –Ω–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã.
 * 
 * FormData ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã.
 * –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ FormData:
 * - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
 * - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∞–π–ª—ã (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏)
 * - –£–¥–æ–±–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ fetch/AJAX
 */
form.addEventListener('submit', function (event) {
    // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
    event.preventDefault();

    // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π
    const isUsernameValid = username.value.length >= 3;
    const isEmailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value);
    const isPasswordValid = password.value.length >= 6;
    const isConfirmValid = confirmPassword.value === password.value;

    if (isUsernameValid && isEmailValid && isPasswordValid && isConfirmValid) {
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ FormData
        const formData = new FormData(form);

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –æ–±—ã—á–Ω—ã–π –æ–±—ä–µ–∫—Ç
        const data = Object.fromEntries(formData);

        // –£–¥–∞–ª—è–µ–º –ø–∞—Ä–æ–ª–∏ –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!)
        delete data.password;
        delete data.confirmPassword;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        result.style.display = 'block';
        result.innerHTML = `
            <h3>‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</h3>
            <p>–î–∞–Ω–Ω—ã–µ:</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
        `;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
        form.reset();

        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        document.querySelectorAll('input').forEach(input => {
            input.classList.remove('valid', 'invalid');
        });
    } else {
        result.style.display = 'block';
        result.style.background = '#f8d7da';
        result.innerHTML = '<h3>‚ùå –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ</h3>';
    }
});

// ================================================
// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
// ================================================

console.log('üìù –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞–º–∏ –∑–∞–≥—Ä—É–∂–µ–Ω!');
console.log('–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.');
