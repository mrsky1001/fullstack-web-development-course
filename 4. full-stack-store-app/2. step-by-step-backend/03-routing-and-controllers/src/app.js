/**
 * ====================================================================
 * –£–†–û–ö 3: –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Ø –ò –ö–û–ù–¢–†–û–õ–õ–ï–†–´ - –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (app.js)
 * ====================================================================
 * 
 * –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –∫–æ–¥ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
 * 
 * 1. Routers (–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã) ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç URL –∏ HTTP –º–µ—Ç–æ–¥—ã
 * 2. Controllers (–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã) ‚Äî —Å–æ–¥–µ—Ä–∂–∞—Ç –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
 * 
 * –≠—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ MVC (Model-View-Controller).
 * 
 * ====================================================================
 */

const express = require('express');
const app = express();

// –®–ê–ì 1: –ü–æ–¥–∫–ª—é—á–∞–µ–º Router'—ã
// --------------------------------------------------------------------
// –ö–∞–∂–¥—ã–π Router ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –≥—Ä—É–ø–ø—É –º–∞—Ä—à—Ä—É—Ç–æ–≤.
// –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º.

const productRouter = require('./routes/product.router');

// –®–ê–ì 2: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º middleware
// --------------------------------------------------------------------

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// –®–ê–ì 3: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
// --------------------------------------------------------------------

app.get('/', (req, res) => {
    res.send(`
        <h1>üöÄ Express.js ‚Äî –ú–∞—Ä—à—Ä—É—Ç—ã –∏ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã</h1>
        <p>–£—Ä–æ–∫ 3: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ —Å Router –∏ Controller</p>
        <h3>API Endpoints:</h3>
        <ul>
            <li><a href="/product/all">GET /product/all</a> ‚Äî –í—Å–µ —Ç–æ–≤–∞—Ä—ã</li>
            <li><a href="/product/1">GET /product/:id</a> ‚Äî –¢–æ–≤–∞—Ä –ø–æ ID</li>
        </ul>
    `);
});

// –®–ê–ì 4: –ü–æ–¥–∫–ª—é—á–∞–µ–º Router'—ã –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
// --------------------------------------------------------------------
// app.use(baseUrl, router) ‚Äî –≤—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã router'–∞ –±—É–¥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å baseUrl
// 
// –ù–∞–ø—Ä–∏–º–µ—Ä:
//   productRouter.get('/all') ‚Üí –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ GET /product/all
//   productRouter.get('/:id') ‚Üí –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ GET /product/:id

app.use('/product', productRouter);

// –®–ê–ì 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ 404 (–º–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω)
// --------------------------------------------------------------------

app.use((req, res) => {
    res.status(404).json({
        status: 'error',
        message: `–ú–∞—Ä—à—Ä—É—Ç ${req.method} ${req.url} –Ω–µ –Ω–∞–π–¥–µ–Ω`,
        statusCode: 404
    });
});

module.exports = app;
