/**
 * ====================================================================
 * MIDDLEWARE: isAuthenticated (Проверка авторизации)
 * ====================================================================
 * 
 * Этот middleware защищает маршруты от неавторизованных пользователей.
 * Используется для маршрутов, которые требуют входа в систему.
 * 
 * Пример использования:
 *   app.use('/shopping-cart', isAuthenticated, cartRouter);
 * 
 * ====================================================================
 */

/**
 * Проверяет, авторизован ли пользователь
 */
exports.isAuthenticated = (req, res, next) => {
    // req.isAuthenticated() — метод Passport.js
    // Возвращает true, если в сессии есть пользователь

    if (req.isAuthenticated()) {
        console.log('✅ Пользователь авторизован:', req.user.email);
        return next(); // Пропускаем дальше
    }

    console.log('⛔ Доступ запрещён (не авторизован)');
    res.status(401).json({
        status: 'error',
        message: 'Необходима авторизация'
    });
};
