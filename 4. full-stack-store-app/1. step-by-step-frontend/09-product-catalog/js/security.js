/**
 * УРОК 9: УТИЛИТЫ БЕЗОПАСНОСТИ (Frontend)
 * =========================================
 * 
 * Набор функций для защиты от распространенных уязвимостей.
 * 
 * ⚠️ ВАЖНО:
 * При работе с пользовательскими данными (имена, описания, комментарии)
 * ВСЕГДА нужно экранировать HTML-символы перед вставкой в DOM.
 * Иначе злоумышленник может внедрить вредоносный скрипт (XSS-атака).
 * 
 * КОНЦЕПЦИИ:
 * - XSS (Cross-Site Scripting) атаки
 * - Экранирование HTML
 * - Безопасная работа с пользовательским вводом
 */

const Security = {
    /**
     * Экранирование HTML-символов для защиты от XSS.
     * Заменяет опасные символы на безопасные HTML-сущности.
     * 
     * @example
     * escapeHtml('<script>alert("XSS")</script>')
     * // Результат: '&lt;script&gt;alert("XSS")&lt;/script&gt;'
     * 
     * @param {string} text - Текст для экранирования
     * @returns {string} - Безопасный текст
     */
    escapeHtml(text) {
        if (!text) return '';

        // Создаем временный текстовый узел и получаем его содержимое.
        // Это безопасный способ экранирования, использующий встроенные
        // механизмы браузера.
        const div = document.createElement('div');
        div.textContent = text; // textContent автоматически экранирует
        return div.innerHTML;   // innerHTML возвращает экранированную версию
    },

    /**
     * Альтернативный метод экранирования через замену символов.
     * Заменяет 5 основных опасных символов.
     * 
     * @param {string} text - Текст для экранирования
     * @returns {string} - Безопасный текст
     */
    escapeHtmlManual(text) {
        if (!text) return '';

        const escapeMap = {
            '&': '&amp;',   // Амперсанд должен быть первым!
            '<': '&lt;',   // Начало HTML-тега
            '>': '&gt;',   // Конец HTML-тега
            '"': '&quot;', // Двойные кавычки (в атрибутах)
            "'": '&#039;'  // Одинарные кавычки
        };

        return text.replace(/[&<>"']/g, char => escapeMap[char]);
    }
};

// Экспортируем глобально
window.Security = Security;

// Удобный короткий алиас (часто используется)
window.escapeHtml = Security.escapeHtml;

/*
 * ЧТО ТАКОЕ XSS-АТАКА?
 * 
 * XSS (Cross-Site Scripting) — это атака, при которой злоумышленник
 * внедряет вредоносный JavaScript-код на страницу.
 * 
 * Пример уязвимого кода:
 * container.innerHTML = `<h3>${product.name}</h3>`;
 * 
 * Если product.name = '<script>stealCookies()</script>',
 * то этот код выполнится в браузере пользователя!
 * 
 * Безопасный код:
 * container.innerHTML = `<h3>${escapeHtml(product.name)}</h3>`;
 * 
 * Теперь тег <script> будет отображаться как текст,
 * а не выполняться как код.
 * 
 * ПРАВИЛО: Всегда экранируйте данные, полученные от пользователей
 * или из внешних источников (API, БД), перед вставкой в HTML!
 */
